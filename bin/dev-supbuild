#!/usr/bin/env python
import argparse
import sys
import getpass

from ansible import runner

parser = argparse.ArgumentParser()
parser.add_argument('action', help='build, list, delete, power-on, power-off')
args = parser.parse_args()

def get_user():
    return getpass.getuser()

def list_vms():
    user = get_user()
    cmd = 'xe vm-list params=name-label,uuid,power-state,networks | grep -B1 -A2 %s' % (user)
    task = runner.Runner(
        module_name='shell',
        module_args=cmd
    )
    results = task.run()
    return results

class __main__():
    if args.action == 'build':
        print 'BUILD WHAT?!'
    elif args.action == 'list':
        results = list_vms()
        contacted = results['contacted']
        for host, output in contacted.iteritems():
            stdout = output['stdout']
            if len(stdout) == 0:
                stdout = ' - None\n'
            print 'Host: %s' % (host)
            for line in stdout.split('\n'):
                print line
    elif args.action == 'delete':
        print 'delete stuff'
    elif args.action == 'power-on':
        print 'power-on stuff'
    elif args.action == 'power-off':
        print 'power-off stuff'

